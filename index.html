<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Suivi transparent des promesses √©lectorales du Pr√©sident Bassirou Diomaye Faye">
  <meta name="theme-color" content="#2a6d5d">
  <meta property="og:title" content="Suivi Promesses ‚Ä¢ Diomaye Pr√©sident 2024">
  <meta property="og:description" content="Tableau de bord transparent de suivi des 99 engagements">
  <meta property="og:type" content="website">
  <title>Suivi Promesses ‚Ä¢ Diomaye Pr√©sident 2024</title>
  
  <!-- Fonts & Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" integrity="sha512-Avb2QiuDEEvB4bZJYdft2mNjVShBftLdPG8FJ0V7irTLQ8Uo0qcPxh4Plq7G5tGm0rU+1SPhVotteLpBERwTkw==" crossorigin="anonymous" referrerpolicy="no-referrer">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Styles -->
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="bg-pattern"></div>
  
  <div class="container">
    <header class="header">
      <div class="share-dashboard">
        <a href="#" id="share-twitter-dash" class="share-dashboard-btn share-twitter" title="Partager sur X">
          <i class="fab fa-x-twitter"></i>
        </a>
        <a href="#" id="share-facebook-dash" class="share-dashboard-btn share-facebook" title="Partager sur Facebook">
          <i class="fab fa-facebook-f"></i>
        </a>
        <a href="#" id="share-whatsapp-dash" class="share-dashboard-btn share-whatsapp" title="Partager sur WhatsApp">
          <i class="fab fa-whatsapp"></i>
        </a>
        <a href="#" id="share-linkedin-dash" class="share-dashboard-btn share-linkedin" title="Partager sur LinkedIn">
          <i class="fab fa-linkedin-in"></i>
        </a>
      </div>
      <div class="header-content">
        <h1>üá∏üá≥ Le Projet : Diomaye Pr√©sident</h1>
        <p class="subtitle">Tableau de Bord Transparent du Suivi des <span id="total-count">99</span> Engagements</p>
        <span class="ref-badge">
          <i class="fas fa-calendar-check"></i>
          Date de r√©f√©rence : 2 AVRIL 2024
        </span>
      </div>
    </header>

    <div class="stats-grid">
      <div class="stat-card">
        <div class="stat-value" id="total">0</div>
        <div class="stat-label">Engagements Total</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="realise">0</div>
        <div class="stat-label">‚úÖ R√©alis√©s</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="encours">0</div>
        <div class="stat-label">üîÑ En Cours</div>
      </div>
      <div class="stat-card stat-card-warning">
        <div class="stat-value" id="retard">0</div>
        <div class="stat-label">‚ö†Ô∏è En Retard</div>
      </div>
    </div>

    <div class="filters">
      <div class="input-group">
        <i class="fas fa-search"></i>
        <input type="text" id="search" placeholder="Rechercher un engagement...">
      </div>
      <div class="input-group">
        <i class="fas fa-filter"></i>
        <select id="domaine">
          <option value="">Tous les secteurs</option>
        </select>
      </div>
      <div class="input-group">
        <i class="fas fa-chart-bar"></i>
        <select id="status">
          <option value="">Tous les statuts</option>
          <option value="realise">‚úÖ R√©alis√©</option>
          <option value="en-retard">‚ö†Ô∏è En Retard</option>
          <option value="dans-les-temps">‚è±Ô∏è Dans les d√©lais</option>
        </select>
      </div>
    </div>

    <div class="promises-grid" id="promises-container">
      <div class="loading">
        <div class="spinner"></div>
        <p>Chargement des donn√©es...</p>
      </div>
    </div>

    <footer class="footer">
      <p>Plateforme citoyenne de suivi des engagements ‚Ä¢ Donn√©es √† jour au <span id="current-date"></span></p>
      <div class="footer-links">
        <button onclick="showUpdateGuide()" class="update-link">
          <i class="fas fa-sync-alt"></i> Comment mettre √† jour
        </button>
      </div>
      <p class="footer-note">
        D√©velopp√© avec <i class="fas fa-heart" style="color: #e76f51;"></i> pour la transparence d√©mocratique
      </p>
    </footer>
  </div>

  <!-- JavaScript en UN SEUL fichier pour √©viter les probl√®mes -->
  <script>
    // Configuration globale
    window.CONFIG = {
      DATA_URL: 'promises.json',
      START_DATE: null,
      CURRENT_DATE: new Date(),
      promises: []
    };

    // Fonctions utilitaires
    function calculateDeadline(delaiText) {
      if (!CONFIG.START_DATE) return new Date();
      const text = delaiText.toLowerCase();
      const result = new Date(CONFIG.START_DATE);
      
      if (text.includes("imm√©diat") || text.includes("3 mois")) result.setMonth(result.getMonth() + 3);
      else if (text.includes("6 premiers mois")) result.setMonth(result.getMonth() + 6);
      else if (text.includes("12 premiers mois") || text.includes("1√®re ann√©e")) result.setFullYear(result.getFullYear() + 1);
      else if (text.includes("2 premi√®res ann√©es") || text.includes("2 ans")) result.setFullYear(result.getFullYear() + 2);
      else if (text.includes("3 ans")) result.setFullYear(result.getFullYear() + 3);
      else if (text.includes("4 ans")) result.setFullYear(result.getFullYear() + 4);
      else if (text.includes("5 ans") || text.includes("quinquennat")) result.setFullYear(result.getFullYear() + 5);
      else result.setFullYear(result.getFullYear() + 5);
      
      return result;
    }

    function checkIfLate(status, deadline) {
      return status !== 'realise' && CONFIG.CURRENT_DATE > deadline;
    }

    function updateCurrentDate() {
      const dateElement = document.getElementById('current-date');
      if (dateElement) {
        const options = { day: 'numeric', month: 'long', year: 'numeric' };
        dateElement.textContent = CONFIG.CURRENT_DATE.toLocaleDateString('fr-FR', options);
      }
    }

    // Rendu des statistiques
    function renderStats() {
      const promises = CONFIG.promises;
      const total = promises.length;
      const realise = promises.filter(p => p.status === 'realise').length;
      const encours = promises.filter(p => p.status === 'encours').length;
      const retard = promises.filter(p => p.isLate).length;
      
      document.getElementById('total').textContent = total;
      document.getElementById('realise').textContent = realise;
      document.getElementById('encours').textContent = encours;
      document.getElementById('retard').textContent = retard;
      document.getElementById('total-count').textContent = total;
    }

    // Rendu des filtres
    function renderFilters() {
      const domainFilter = document.getElementById('domaine');
      const domains = [...new Set(CONFIG.promises.map(p => p.domaine))].sort();
      
      domainFilter.innerHTML = '<option value="">Tous les secteurs</option>';
      
      domains.forEach(domain => {
        const option = document.createElement('option');
        option.value = domain;
        option.textContent = domain;
        domainFilter.appendChild(option);
      });
    }

    // Rendu des promesses
    function renderPromises(promises) {
      const container = document.getElementById('promises-container');
      
      if (promises.length === 0) {
        container.innerHTML = `
          <div class="no-results" style="text-align:center; padding:3rem; color:#666; grid-column:1/-1;">
            <i class="fas fa-search fa-3x" style="margin-bottom:1rem;"></i>
            <h3>Aucun r√©sultat trouv√©</h3>
            <p>Essayez de modifier vos crit√®res de recherche</p>
          </div>
        `;
        return;
      }
      
      container.innerHTML = promises.map(promise => {
        const isLate = promise.isLate;
        const statusClass = promise.status === 'realise' ? 'status-realise' : 
                           promise.status === 'non-lance' ? 'status-nonlance' : 'status-encours';
        const statusText = promise.status === 'realise' ? '‚úÖ R√©alis√©' : 
                          promise.status === 'non-lance' ? '‚è±Ô∏è Attente' : 'üîÑ En Cours';
        
        let delayBadge = '';
        if (promise.status === 'realise') {
          delayBadge = '<span class="delay-badge" style="background:#e8f5e9; color:#2a9d8f; padding:0.3rem 0.8rem; border-radius:20px; font-size:0.8rem;"><i class="fas fa-check"></i> Termin√©</span>';
        } else if (isLate) {
          delayBadge = '<span class="delay-badge" style="background:#ffebee; color:#e76f51; padding:0.3rem 0.8rem; border-radius:20px; font-size:0.8rem;"><i class="fas fa-exclamation-triangle"></i> En Retard</span>';
        } else {
          delayBadge = '<span class="delay-badge" style="background:#e3f2fd; color:#3d5a80; padding:0.3rem 0.8rem; border-radius:20px; font-size:0.8rem;"><i class="fas fa-hourglass-half"></i> Dans les d√©lais</span>';
        }
        
        let updatesHTML = '';
        if (promise.mises_a_jour && promise.mises_a_jour.length > 0) {
          updatesHTML = `
            <div class="updates" style="margin-top:1rem; padding:1rem; background:#f8f9fa; border-radius:10px;">
              <strong><i class="fas fa-history"></i> Mises √† jour (${promise.mises_a_jour.length})</strong>
              ${promise.mises_a_jour.map(update => `
                <div style="margin-top:0.5rem; padding:0.5rem 0; border-bottom:1px solid #eee;">
                  <small style="color:#2a6d5d; font-weight:bold;">${update.date}</small>
                  <p style="margin:0.2rem 0; color:#555;">${update.text}</p>
                </div>
              `).join('')}
            </div>
          `;
        }
        
        return `
          <div class="promise-card">
            <span class="domain-badge">${promise.domaine}</span>
            <h3 class="promise-title">${promise.engagement}</h3>
            
            <div class="result-box">
              <i class="fas fa-bullseye"></i> 
              <strong>R√©sultat attendu :</strong> ${promise.resultat}
            </div>
            
            <div class="promise-meta">
              <div class="meta-row">
                <span><i class="fas fa-clock"></i> D√©lai : <strong>${promise.delai}</strong></span>
                ${delayBadge}
              </div>
              <div class="meta-row">
                <span>Statut :</span>
                <span class="status-badge ${statusClass}">${statusText}</span>
              </div>
            </div>
            
            ${updatesHTML}
            
            <div class="rating-section">
              <div class="stars">
                <i class="far fa-star"></i>
                <i class="far fa-star"></i>
                <i class="far fa-star"></i>
                <i class="far fa-star"></i>
                <i class="far fa-star"></i>
              </div>
              <span class="rating-label">Noter cet engagement</span>
            </div>
          </div>
        `;
      }).join('');
    }

    // Filtrage
    function setupEventListeners() {
      document.getElementById('search').addEventListener('input', updateDisplay);
      document.getElementById('domaine').addEventListener('change', updateDisplay);
      document.getElementById('status').addEventListener('change', updateDisplay);
    }

    function updateDisplay() {
      const search = document.getElementById('search').value.toLowerCase();
      const domaine = document.getElementById('domaine').value;
      const status = document.getElementById('status').value;
      
      const filtered = CONFIG.promises.filter(p => {
        const matchSearch = p.engagement.toLowerCase().includes(search) || 
                           p.resultat.toLowerCase().includes(search) ||
                           p.domaine.toLowerCase().includes(search);
        const matchDomaine = !domaine || p.domaine === domaine;
        const matchStatus = !status || 
                           (status === 'realise' && p.status === 'realise') ||
                           (status === 'en-retard' && p.isLate) ||
                           (status === 'dans-les-temps' && !p.isLate && p.status !== 'realise');
        
        return matchSearch && matchDomaine && matchStatus;
      });
      
      renderStats();
      renderPromises(filtered);
    }

    // Partage
    function setupShareButtons() {
      const url = window.location.href;
      const text = 'Suivi des engagements du Pr√©sident Diomaye Faye';
      
      document.getElementById('share-twitter-dash').href = 
        `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(url)}`;
      
      document.getElementById('share-facebook-dash').href = 
        `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`;
      
      document.getElementById('share-whatsapp-dash').href = 
        `https://wa.me/?text=${encodeURIComponent(text + ' ' + url)}`;
      
      document.getElementById('share-linkedin-dash').href = 
        `https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(url)}`;
    }

    // Initialisation
    async function init() {
      try {
        const response = await fetch(CONFIG.DATA_URL);
        const data = await response.json();
        CONFIG.START_DATE = new Date(data.start_date);
        CONFIG.promises = data.promises.map(p => ({
          ...p,
          deadline: calculateDeadline(p.delai),
          isLate: checkIfLate(p.status, calculateDeadline(p.delai)),
          votes: JSON.parse(localStorage.getItem(`vote_${p.id}`)) || []
        }));
        
        updateCurrentDate();
        renderStats();
        renderFilters();
        renderPromises(CONFIG.promises);
        setupEventListeners();
        setupShareButtons();
        
      } catch (error) {
        console.error('Erreur:', error);
        document.getElementById('promises-container').innerHTML = `
          <div style="text-align:center; padding:3rem; color:#e76f51; grid-column:1/-1;">
            <i class="fas fa-exclamation-triangle fa-3x"></i>
            <h3>Erreur de chargement</h3>
            <p>Impossible de charger les donn√©es promises.json</p>
            <button onclick="location.reload()" style="margin-top:1rem; padding:0.5rem 1rem; background:#2a6d5d; color:white; border:none; border-radius:5px; cursor:pointer;">
              <i class="fas fa-redo"></i> R√©essayer
            </button>
          </div>
        `;
      }
    }

    // Guide de mise √† jour
    window.showUpdateGuide = function() {
      alert("Pour mettre √† jour :\n\n1. Modifiez le fichier promises.json\n2. Changez le 'status' √† : 'realise', 'encours', ou 'non-lance'\n3. Ajoutez des mises √† jour dans 'mises_a_jour'\n4. Sauvegardez sur GitHub\n5. Rechargez la page pour voir les changements");
    };

    // D√©marrer l'application
    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
